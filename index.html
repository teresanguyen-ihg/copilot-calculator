<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Microsoft Copilot Studio Enterprise Cost Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0078d4 0%, #106ebe 50%, #005a9e 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            padding: 30px;
            width: 100%;
            max-width: 1400px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            align-items: start;
        }

        h1 {
            color: #323130;
            font-size: 2.2em;
            margin-bottom: 10px;
            text-align: center;
            grid-column: 1 / -1;
            background: linear-gradient(45deg, #0078d4, #106ebe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 600;
            line-height: 1.2;
        }

        .subtitle {
            text-align: center;
            color: #605e5c;
            margin-bottom: 20px;
            grid-column: 1 / -1;
            font-size: 1em;
            line-height: 1.4;
        }
        
        .controls {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .visualization {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .section-title {
            font-size: 1.2em;
            font-weight: 600;
            color: #323130;
            margin-bottom: 12px;
            padding-bottom: 6px;
            border-bottom: 2px solid #0078d4;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .user-split-container {
            background: #f8f9ff;
            border: 2px solid #c7e0f4;
            border-radius: 10px;
            padding: 15px;
        }

        .user-split-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 10px;
        }

        label {
            font-weight: 600;
            color: #323130;
            font-size: 0.95em;
            line-height: 1.3;
        }

        .help-text {
            font-size: 0.8em;
            color: #605e5c;
            margin-top: 2px;
            line-height: 1.3;
        }

        input[type="number"], select {
            padding: 12px 15px;
            border: 2px solid #edebe9;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s ease;
            background: white;
            color: #323130;
            width: 100%;
        }

        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #0078d4;
            box-shadow: 0 0 0 2px rgba(0, 120, 212, 0.2);
        }

        select {
            cursor: pointer;
        }

        .chart-container {
            position: relative;
            height: 350px;
            background: white;
            border-radius: 12px;
            padding: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            border: 1px solid #edebe9;
        }

        .summary, .comparison {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, #f3f9ff 0%, #deecff 100%);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #c7e0f4;
        }
        
        .summary h3, .comparison h3 {
            color: #323130;
            margin-bottom: 12px;
            font-size: 1.2em;
            text-align: center;
        }

        .cost-breakdown, .comparison-breakdown {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }
        
        .cost-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
            border: 1px solid #edebe9;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .cost-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }

        .cost-value {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .cost-label {
            color: #323130;
            font-size: 0.9em;
            font-weight: 600;
            line-height: 1.3;
        }

        .cost-sub-label {
            color: #605e5c;
            font-size: 0.75em;
            line-height: 1.3;
            margin-top: 8px;
        }

        .payg-color { color: #d13438; }
        .pack-color { color: #005a9e; }

        .usage-insights {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .insight-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 12px;
        }


        .insight-item {
            padding: 12px;
            border-left: 4px solid #0078d4;
            background: #f8f9ff;
            border-radius: 6px;
        }

        .insight-title {
            font-weight: 600;
            color: #323130;
            margin-bottom: 6px;
            font-size: 0.9em;
        }

        .insight-text {
            color: #605e5c;
            font-size: 0.8em;
            line-height: 1.4;
        }

        .best-option {
            border: 2px solid #107c10;
            box-shadow: 0 6px 16px rgba(16, 124, 16, 0.2);
        }
        .reference-link {
            grid-column: 1 / -1;
            text-align: center;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f0f8ff 0%, #e6f3ff 100%);
            border-radius: 10px;
            border: 2px solid #c7e0f4;
        }

        .reference-link a {
            color: #0078d4;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s ease;
        }

        .reference-link a:hover {
            color: #106ebe;
            text-decoration: underline;
        }        

        @media (max-width: 1024px) {
            .container { grid-template-columns: 1fr; }
            .cost-breakdown, .comparison-breakdown { grid-template-columns: 1fr; }
        }

        @media (max-width: 768px) {
            .user-split-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Microsoft Copilot Studio Enterprise Cost Calculator</h1>
        <p class="subtitle">Analyze costs based on the specific mix of licensed and unlicensed users</p>
        
        <div class="reference-link">
            <a href="https://microsoft.github.io/copilot-studio-estimator/" target="_blank" rel="noopener noreferrer">
                <svg style="width: 16px; height: 16px; fill: currentColor;" viewBox="0 0 16 16">
                    <path d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"/>
                    <path d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"/>
                </svg>
                Official Microsoft Copilot Studio Estimator
            </a>
        </div>

        <div class="controls">
            <div class="user-split-container">
                <div class="section-title">User Allocation</div>
                <div class="user-split-grid">
                    <div class="input-group">
                        <label for="licensedUsers">Licensed Users:</label>
                        <input type="number" id="licensedUsers" value="100" min="0">
                        <div class="help-text">Users with full M365 Copilot licenses ($30/user/month).</div>
                    </div>
                    <div class="input-group">
                        <label for="unlicensedUsers">Unlicensed Users:</label>
                        <input type="number" id="unlicensedUsers" value="50" min="0">
                        <div class="help-text">Users without licenses, incurring message-based charges.</div>
                    </div>
                </div>
                <div class="input-group" style="margin-top: 12px;">
                    <label style="color: #0078d4;">Total Users: <span id="totalUsersDisplay">150</span></label>
                </div>
            </div>

            <div>
                <div class="section-title">Unlicensed User Configuration</div>
                <div class="input-group" style="margin-bottom: 15px;">
                    <label for="queriesPerDay">Average Queries per Unlicensed User per Day:</label>
                    <input type="number" id="queriesPerDay" value="10" min="1">
                </div>
                <div class="input-group" style="margin-bottom: 15px;">
                    <label for="dataAccessType">Primary Data Access Pattern:</label>
                    <select id="dataAccessType">
                        <option value="sharepoint">SharePoint Documents Only (2 msg/query)</option>
                        <option value="mixed" selected>Mixed Organizational Data (16 msg/query)</option>
                        <option value="advanced">Advanced Graph/Database (24.4 msg/query)</option>
                    </select>
                    <div class="help-text" style="margin-top: 8px; line-height: 1.5;">
                         <strong>SharePoint Only:</strong> For basic questions answered by searching text within SharePoint files.<br>
                         <strong>Mixed Data:</strong> For complex queries that relate data, like finding documents from a specific team on a project.<br>
                         <strong>Advanced Graph:</strong> For deep analytical questions connecting info across multiple systems (databases, CRMs).
                    </div>
                </div>
                <div class="input-group">
                    <label for="seasonalMultiplier">Seasonal/Peak Usage Multiplier:</label>
                    <select id="seasonalMultiplier">
                        <option value="1" selected>Normal Operations (1x)</option>
                        <option value="1.5">Moderate Peaks (1.5x)</option>
                        <option value="2">High Peaks (2x)</option>
                        <option value="3">Extreme Peaks (3x)</option>
                    </select>
                </div>
            </div>
        </div>
        
        <div class="visualization">
            <div class="chart-container">
                <canvas id="costChart"></canvas>
            </div>
            <div class="usage-insights">
                <h3 class="section-title">Strategic Insights</h3>
                <div class="insight-grid">
                    <div class="insight-item">
                        <div class="insight-title">Purchasing Recommendation</div>
                        <div class="insight-text" id="purchasingInsight">...</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-title">License Mix Analysis</div>
                        <div class="insight-text" id="licenseMixInsight">...</div>
                    </div>
                    <div class="insight-item">
                        <div class="insight-title">Break-Even Analysis</div>
                        <div class="insight-text" id="breakEvenInsight">...</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="summary">
            <h3>Overall Monthly Cost Breakdown</h3>
            <div class="cost-breakdown">
                <div class="cost-item" id="paygScenarioCard">
                    <div>
                        <div class="cost-value payg-color" id="totalCostPayg">...</div>
                        <div class="cost-label">Total with Pay-as-you-go</div>
                    </div>
                    <div class="cost-sub-label" id="totalCostPaygDetails">...</div>
                </div>
                <div class="cost-item" id="packScenarioCard">
                    <div>
                        <div class="cost-value pack-color" id="totalCostPacks">...</div>
                        <div class="cost-label">Total with Message Packs</div>
                    </div>
                    <div class="cost-sub-label" id="totalCostPacksDetails">...</div>
                </div>
            </div>
        </div>

        <div class="comparison">
            <h3>Unlicensed User Portion: Cost Comparison</h3>
            <div class="comparison-breakdown">
                <div class="cost-item">
                    <div class="cost-value payg-color" id="paygPortionCost">...</div>
                    <div class="cost-label">Pay-as-you-go Cost<br><span class="cost-sub-label" id="paygPortionDetails">...</span></div>
                </div>
                <div class="cost-item">
                    <div class="cost-value pack-color" id="packPortionCost">...</div>
                    <div class="cost-label">Message Pack Cost<br><span class="cost-sub-label" id="packPortionDetails">...</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const messageMultipliers = {
                sharepoint: 2,
                mixed: 16,
                advanced: 24.4
            };

            const allInputs = [
                document.getElementById('licensedUsers'),
                document.getElementById('unlicensedUsers'),
                document.getElementById('queriesPerDay'),
                document.getElementById('dataAccessType'),
                document.getElementById('seasonalMultiplier')
            ];

            const ctx = document.getElementById('costChart').getContext('2d');
            const myChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Total with PAYG', 'Total with Message Packs'],
                    datasets: [{
                        label: 'Total Monthly Cost ($)',
                        data: [],
                        backgroundColor: [
                            'rgba(209, 52, 56, 0.8)',
                            'rgba(0, 90, 158, 0.8)'
                        ],
                        borderColor: [
                            'rgba(209, 52, 56, 1)',
                            'rgba(0, 90, 158, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { callbacks: { label: context => `Cost: $${context.parsed.y.toLocaleString()}` } }
                    },
                    scales: {
                        y: { beginAtZero: true, ticks: { callback: value => '$' + value.toLocaleString() } }
                    }
                }
            });

            function updateCalculations() {
                const [licensedUsers, unlicensedUsers, queriesPerDay, dataAccessType, seasonalMultiplier] = allInputs.map(input => {
                    return input.type === 'number' ? parseInt(input.value) || 0 : input.value;
                });

                document.getElementById('totalUsersDisplay').textContent = (licensedUsers + unlicensedUsers).toLocaleString();

                const messagesPerQuery = messageMultipliers[dataAccessType];
                const workingDays = 22;

                // --- Calculate Costs ---
                const licenseCost = licensedUsers * 30;
                const unlicensedMonthlyMessages = unlicensedUsers * queriesPerDay * workingDays * messagesPerQuery * seasonalMultiplier;
                
                const paygCostForUnlicensed = unlicensedMonthlyMessages * 0.01;
                
                const packsNeeded = Math.ceil(unlicensedMonthlyMessages / 25000);
                const packCostForUnlicensed = packsNeeded * 200;

                const totalMonthlyCostPayg = licenseCost + paygCostForUnlicensed;
                const totalMonthlyCostPacks = licenseCost + packCostForUnlicensed;
                
                // --- Update Main Summary Breakdown ---
                document.getElementById('totalCostPayg').textContent = `$${Math.round(totalMonthlyCostPayg).toLocaleString()}`;
                document.getElementById('totalCostPaygDetails').innerHTML = `
                    $${Math.round(licenseCost).toLocaleString()} (Licenses) + $${Math.round(paygCostForUnlicensed).toLocaleString()} (PAYG)
                    <br><strong>Annual: $${Math.round(totalMonthlyCostPayg * 12).toLocaleString()}</strong>`;
                
                document.getElementById('totalCostPacks').textContent = `$${Math.round(totalMonthlyCostPacks).toLocaleString()}`;
                document.getElementById('totalCostPacksDetails').innerHTML = `
                    $${Math.round(licenseCost).toLocaleString()} (Licenses) + $${Math.round(packCostForUnlicensed).toLocaleString()} (Packs)
                    <br><strong>Annual: $${Math.round(totalMonthlyCostPacks * 12).toLocaleString()}</strong>`;

                // Highlight the cheaper overall option
                const paygCard = document.getElementById('paygScenarioCard');
                const packCard = document.getElementById('packScenarioCard');
                paygCard.classList.remove('best-option');
                packCard.classList.remove('best-option');

                if (totalMonthlyCostPayg < totalMonthlyCostPacks) {
                    paygCard.classList.add('best-option');
                } else if (totalMonthlyCostPacks < totalMonthlyCostPayg) {
                    packCard.classList.add('best-option');
                }

                // --- Update Comparison Section ---
                document.getElementById('paygPortionCost').textContent = `$${Math.round(paygCostForUnlicensed).toLocaleString()}`;
                document.getElementById('paygPortionDetails').textContent = `${(unlicensedMonthlyMessages/1000).toFixed(1)}K messages`;
                document.getElementById('packPortionCost').textContent = `$${Math.round(packCostForUnlicensed).toLocaleString()}`;
                document.getElementById('packPortionDetails').textContent = `${packsNeeded} pack(s) needed`;

                // --- Update Chart ---
                myChart.data.datasets[0].data = [totalMonthlyCostPayg, totalMonthlyCostPacks];
                myChart.update();

                // --- Update Insights ---
                updateInsights(licensedUsers, unlicensedUsers, paygCostForUnlicensed, packCostForUnlicensed, dataAccessType);
            }

            function updateInsights(licensed, unlicensed, paygCost, packCost, dataType) {
                // Purchasing Recommendation
                let purchasingInsight = '';
                if (unlicensed > 0) {
                    if (packCost < paygCost) {
                        purchasingInsight = `Purchasing message packs is the more cost-effective choice for your unlicensed users, saving $${Math.round(paygCost - packCost).toLocaleString()} per month.`;
                    } else {
                        purchasingInsight = 'The Pay-as-you-go model is currently the most economical option for your unlicensed users.';
                    }
                } else {
                    purchasingInsight = 'All users are licensed. No purchasing decision for unlicensed usage is needed.';
                }
                document.getElementById('purchasingInsight').textContent = purchasingInsight;
                
                // License Mix Analysis
                const total = licensed + unlicensed;
                const licensePercentage = total > 0 ? (licensed / total * 100) : 0;
                let licenseMixInsight = `${licensePercentage.toFixed(0)}% of users are licensed. `;
                if (licensePercentage === 100) licenseMixInsight += "This provides maximum cost predictability.";
                else if (licensePercentage >= 70) licenseMixInsight += "This mix favors cost predictability for consistent, heavy usage.";
                else if (licensePercentage >= 30) licenseMixInsight += "This is a balanced hybrid approach for mixed usage patterns.";
                else licenseMixInsight += "This mix favors flexibility for variable or infrequent usage.";
                if (total === 0) licenseMixInsight = "Enter user numbers to begin analysis.";
                document.getElementById('licenseMixInsight').textContent = licenseMixInsight;

                // Break-Even Analysis
                const costPerUnlicensedUser = unlicensed > 0 ? paygCost / unlicensed : 0;
                const messagesPerQuery = messageMultipliers[dataType];
                const breakEvenQueries = (30 / (22 * messagesPerQuery * 0.01)).toFixed(1);
                let breakEvenInsight = `A full license becomes cheaper than PAYG for an unlicensed user if they average over ${breakEvenQueries} queries per day. `;
                if (unlicensed > 0) {
                     breakEvenInsight += `Currently, your average PAYG cost is $${costPerUnlicensedUser.toFixed(2)} per user.`;
                }
                document.getElementById('breakEvenInsight').textContent = breakEvenInsight;
            }

            allInputs.forEach(input => input.addEventListener('input', updateCalculations));
            updateCalculations(); // Initial calculation on page load
        });
    </script>
</body>
</html>
